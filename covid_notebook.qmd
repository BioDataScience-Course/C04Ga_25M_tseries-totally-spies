---
title: "Mobilité en Wallonie avant et pendant la pandémie COVID-19"
author: "Basile Vandendyck, Mathilda Devries, Juliette Hayt, Norah Martin"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
bibliography: references.bib
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but. Vous devez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

La COVID-19, également appelée maladie à coronavirus 2019, a déclenché une pandémie mondiale sans précédent. Pour limiter la propagation du virus, les gouvernements ont mis en place diverses mesures qui ont profondément modifié les endroits que nous avions l’habitude de fréquenter [@Google]. Par conséquent, nos visites au travail, pour faire les courses ou pour nos loisirs ont été impactées.

Cette étude vise à analyser les effets de la COVID-19, entre 2020 et 2022, sur les lieux fréquentés par la population active, en se concentrant sur les changements dans leur vie professionnelle et quotidienne.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets déjà réalisés. -->

Les données sur la mobilité en Wallonie durant le Covid-19 proviennent de \[Google\]. Google met aussi à disposition trois rapports, un pour chaque année d'intérêt, qui décrivent les données.

L'analyse est réalisée avec la SciViews Box 2025 dans Saturn Cloud (Linux), utilisant le logiciel R (r R.version.string). Le package {pastecs} version r packageVersion("pastecs") est utilisé pour étudier la série temporelle.

## Analyses

<!--% Lisez bien les éléments devant guider votre analyse proposée dans le README.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts")
```

<!--% Ajoutez le nombre de chunks que vous souhaitez. Répartissez-vous le travail correctement. Structurez la section en partie avec des titres explicites de niveau trois.-->

```{r Import}
covid <- read$rds("data/mobility_wallonia.rds")
class(covid)
```

```{r varnames}
covid %>.%
  sselect(., retail_and_recreation_percent_change_from_baseline, workplaces_percent_change_from_baseline, residential_percent_change_from_baseline) %>.%
  srename(., 
    retail_and_recreation_percent_change_from_baseline = "activité",
    workplaces_percent_change_from_baseline = "job",
    residential_percent_change_from_baseline = "maison") -> 
  covid1
```

### Série 1 : Evolution du temps passée à la maison au cours du temps

```{r}
maison_ts<-ts(covid1$maison, start = c(2020,46), frequency = 365)
plot(maison_ts)
```

```{r decomp1}
maison_decomp <- tsd(maison_ts, method = "median", order = 8, times = 10)
plot(maison_decomp, xlab = "Temps passé à la maison")
```

```{r plotmaison}
plot(maison_decomp, stack = FALSE, resid = FALSE, col = c("grey80", "red"), lpos = "topright", xlab = "Temps passé à la maison")

```

On peut voir dans ce graphique que nous avons une très grande augmentation du temps passée à la maison en 2020, cela correspond au moment du premier confinement, on voit aussi une seconde augmentation en 2021 ( entre 220 jours et 600jours), qui correpond confinement puis on assiste à une baisse progressive qui correspond au déconfinement progressif.

Il est intéressant aussi de remarquer que en 2022 lors du retour à la "normale" le temps passée à la maison est légèrement plus haut que ce qu'il était au tout début 2020 avant le covid.

Essayons maintenant de reproduire notre analyse, en prenant en compte les jours et weekend :

```{r}
covidw <- covid
# Calcul des jours de la semaine
covidw$weekdays <- weekdays(as.POSIXct(covidw$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidw[covidw$weekdays == "Saturday" | covidw$weekdays == "Sunday" , 2:7] <- NA 
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidw_ts <- ts(covidw$residential_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(covidw_ts)
# Aggrégation par moyenne des valeurs par semaine
covidw_ts2 <- aggregate(covidw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidw_ts2)
tsp(covidw_ts2)
```

```{r decompmaison2}
decompmaison2 <-tsd(covidw_ts2, method = "median", order = 2, times = 10)
plot(decompmaison2)
```

```{r}
plot(decompmaison2, stack = FALSE, resid = FALSE, col = c("grey80", "red"), lpos = "topright", xlab = "Temps passé à la maison", main = "Evolution du temps passé à la maison entre 2020 et 2022")
```

### Série 2 : Déplacements jusqu'au travail en fonction de l'évolution du Covid-19

```{r tsjob}
tsjob <- ts(covid1$job, start = c(2020,46), frequency = 365)
plot(tsjob, xlab = "Temps [années]", ylab = "Déplacements jusqu'au travail", main = "Déplacements des travailleurs pendant le Covid")
```

```{r acfjob}
acf(tsjob)
```

L'acf montre qu'il existe potentiellement une tendnace générale à la diminution. Potentiellement la présence de cycle de fréquence 0,02 (correspondant à un cycle tous les 7jours plus ou moins. Les travailleurs se déplacent beaucoup en semaine, peu le week-end. Nous vérifierons cette dernière affirmation avec les graphiques suivant.

```{r semaine}
covidsemj <- covid
# Calcul des jours de la semaine
covidsemj$weekdays <- weekdays(as.POSIXct(covidsemj$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidsemj[covidsemj$weekdays == "Saturday" | covidsemj$weekdays == "Sunday" , 2:7] <- NA 
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidsemj_ts <- ts(covidsemj$workplaces_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(covidsemj_ts)
# Aggrégation par moyenne des valeurs par semaine
covidsemj_ts2 <- aggregate(covidsemj_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidsemj_ts2, main = "Déplacement durant la semaine aggrégé en semaines")
```

```{r we}
covidwej <- covid
# Calcul des jours de la semaine
covidwej$weekdays <- weekdays(as.POSIXct(covidwej$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidwej[covidwej$weekdays == "Monday" |
        covidwej$weekdays == "Tuesday" |
        covidwej$weekdays == "Wednesday" |
        covidwej$weekdays == "Thursday" |
        covidwej$weekdays == "Friday", 2:7] <- NA
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidwej_ts <- ts(covidwej$workplaces_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(covidwej_ts)
# Aggrégation par moyenne des valeurs par semaine
covidwej_ts2 <- aggregate(covidwej_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidwej_ts2, main = "Déplacement durant le WE aggrégé en semaines")
```

```{r combinaison}
plot(tsjob,
     main = "Déplacement hebdomadaire des travailleurs pendant le Covid",
     xlab = "Année",
     ylab = "Déplacement jusqu'au travail",
     col = "lightgrey",
     lwd = 1)

#Série semaine
lines(covidsemj_ts2, col = "#FFA500" , lwd = 2)

#Série WE
lines(covidwej_ts2, col = "violet", lwd = 2)

#Légende
legend("bottomright",
       legend = c("Brute", "Semaine", "Week-end"),
       col = c("lightgrey", "#FFA500", "violet"),
       lwd = c(1, 2, 2),
       bty = "n")
```

On peut voir que les gens semblent plus se déplacer pour se rendre au travail pendant le weekend que pendant la semaine tout au long du Covid. Cela peut être expliqué par le fait que les personnes qui n'avaient pas le choix que de travailler comme les commerçants dans l'alimentaire, le personnel soignant, etc étaient les seuls à se déplacer le weekend alors que tous les autres étaient priés de rester chez eux.

J'ai regardé pour les valeurs et à part dire que c'est une augmentation ou une diminution par rapport à une valeur médiane, ils ne disent rien d'autre. Je vais voir avec les autres s'ils ont l'info.

### Activités

Intérressons nous a la mobilité pour les lieux de commerces et loisirs.

```{r activites}
activite_ts <- ts(covid1$activité, start = c(2020,46), frequency = 365)
plot(activite_ts)
```

Un filtrage par EVF est réalisé pour débruités la séries

```{r}
activite_evf1 <- tsd(activite_ts, method = "evf", lag = 30, axes = 1)
plot(activite_evf1, col = 1:3)
```

```{r}
activite_evf2 <- tsd(activite_ts, method = "evf", lag = 30, axes = c(1,2))
plot(activite_evf2, col = 1:3)
```

Il y a une diminution drastiques des déplacements vers les commerces et activités de loisirs au début de 2020. Cette diminution est suivie d'une forte augmentation des déplacements vers les commerces et loisirs 3 mois plus tard. Un palier est observé ensuite. Il y a une légère rechute fin 2020 avec une augmentation progressive de mobilité pour les commerces et loisirs au début 2021. Cette augmentation se stabilise durant l'année 2021 et fluctuent très peut au cours de l'année 2022. On remarque que les déplacements vers les commerces et loisirs est légèrement supérieur a partir de 2021 par rapport au première mesures de 2020.

On choisira le filtrage par evf avec un seul axe pour le rapport car il permet d'avoir une meilleur compréhension générale de la série temporelle.

Un filtrage de méthode de médianes a été réalisé

```{r median}
activite_med <- tsd(activite_ts, method = "median", order = 30
  )
plot(activite_med, col = 1:2)
plot(activite_med, stack = FALSE, resid = FALSE, col = c("grey50", "blue"),lpos = c(750, -40))
```

La forme globale de la série temporelle est presque identique avec celle du filtrages par EVF. Dans ce graphiques, les pics sont remplacés par des paliers, ce qui est conforme a la méthodes par médiane mobiles. Cette méthode est plus visuelle mais n'apporte pas d'infos plus précises que le filtrages EVF.

Pour clarifier la situation un graphique rassemblant les deux méthodes de filtrages et la série brutes a été réalisé.

```{r}
activite_trend <- extract(activite_evf1, components = "filtered")
activite_trend_med <- extract(activite_med, components = "filtered")
plot(activite_ts, 
  main = "Déplacement journalier des citoyens vers les commercerces et loisirs",
     xlab = "Année",
     ylab = "Déplacement jusqu'au commerces et loisirs",
     col = "grey",
     lwd = 1)
lines(activite_trend, col = "#FFA500" , lwd = 2)
lines(activite_trend_med, col = "blue" , lwd = 2)
legend("bottomright",
       legend = c("Brute", "EVF", "Medianes"),
       col = c("grey", "#FFA500", "blue"),
       lwd = c(1, 2, 2),
       bty = "n")
```

Ce graphique permet de visualiser le peu de différences entre les méthodes de filtrages.

Pour la suite de l'analyse, les jours de la semaine et les weekends ont été séparés pour comparer les déplacements pour les commerces et les loisirs.

Séries temporelles des jours de la semaine

```{r}
covidaw <- covid
# Calcul des jours de la semaine
covidaw$weekdays <- weekdays(as.POSIXct(covidw$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidaw[covidaw$weekdays == "Saturday" | covidaw$weekdays == "Sunday" , 2:7] <- NA 
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidaw_ts <- ts(covidaw$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(covidaw_ts)
# Aggrégation par moyenne des valeurs par semaine
covidaw_ts2 <- aggregate(covidaw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidaw_ts2)
```

Élimination des jours de la semaine

```{r}
# Copie de la série initiale sous une autre nom
covida_we <- covid
# Calcul des jours de la semaine
covida_we$weekdays <- weekdays(as.POSIXct(covida_we$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covida_we[covida_we$weekdays == "Monday" | covida_we$weekdays == "Tuesday"| covida_we$weekdays == "Wednesday" |covida_we$weekdays == "Thursday" | covida_we$weekdays == "Friday" , 2:7] <- NA 
covidawe_ts <- ts(covida_we$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(covidawe_ts)
# Aggrégation par moyenne des valeurs par semaine
covidawe_ts2 <- aggregate(covidawe_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidawe_ts2)
```

Comparaison des tendances de mobilités pour les commerces et loisirs

```{r}
plot(activite_ts,
     main = " Déplacement vers les commerces et loisirs pendant le Covid",
     xlab = "Année",
     ylab = "Déplacement vers les commerces et loisirs",
     col = "lightgrey",
     lwd = 1)

#Série semaine
lines(covidaw_ts2, col = "#FFA500" , lwd = 2)

#Série WE
lines(covidawe_ts2, col = "violet", lwd = 2)

#Légende
legend("bottomright",
       legend = c("Brute", "Semaine", "Week-end"),
       col = c("lightgrey", "#FFA500", "violet"),
       lwd = c(1, 2, 2),
       bty = "n")
```

En début 2020, les déplacements vers les commerces et loisirs la semaine et le week-end sont très proches et diminuent fortement comme vu précédement. il y a ensuite une augmentation 3 mois plus tard avec également peu de différence entre les jours de la semaine et le week-end. la fin d'année de 2021est marquée par une diminution de fréquentations des commerces et loisirs. Pendant l'année 2021, les déplacements vers le commerces et les loisirs est plus faibles le week-end que la semaine. Cela reste similaire le restant de l'année 2021. A partir de 2022 la mobilité vers les commerces et loisirs le week-end est légèrement plus élevé que la semaine.

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les éléments les plus pertinents que vous retenez ? -->

...vos conclusions ici...

## Références
